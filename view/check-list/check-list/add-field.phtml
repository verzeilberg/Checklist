<?php
$this->headTitle('Add Checklist');
$this->mainMenu()->setActiveItemId('checklistbeheer');
$this->pageBreadcrumbs()->setLayout('beheer');
$this->pageBreadcrumbs()->setItems([
    'Beheer' => $this->url('beheer'),
    'CheckList' => $this->url('beheer/checklist', ['action' => 'add-field', 'id' => $checklist->getId()]),
    'Add CheckList field' => $this->url('beheer/checklist', ['action' => 'add'])
]);
$form->setAttributes(array(
    'class' => 'form-horizontal',
    'enctype' => 'multipart/form-data'
));
?>
<!-- Page Header -->
<div class="row">
    <h1 class="col">CHECKLIST: <?php echo $checklist->getName(); ?></h1>
</div>
<!-- Breadcrumbs -->
<div class="row">
    <div class="col">
        <?= $this->pageBreadcrumbs()->render(); ?>
    </div>
</div>
<?php
echo $this->partial('partial/checklist-fields.phtml', ['checklist' => $checklist]);
?>
<!-- THIRD Page Header -->
<div class="row">
    <h1 class="col">CHECKLIST FIELDS</h1>
</div>
<?php echo $this->form()->openTag($form); ?>
<div class="row">
    <div class="col">
        <div class="form-group">
            <?php echo $this->formLabel($form->get('order')); ?>
            <?php echo $this->formNumber($form->get('order')); ?>
            <?php echo $this->formElementErrors($form->get('checklistFieldType')); ?>
        </div>
    </div>
</div>
<div class="row">
    <div class="col">
        <div class="form-group">
            <?php echo $this->formLabel($form->get('name')); ?>
            <?php echo $this->formText($form->get('name')); ?>
            <?php echo $this->formElementErrors($form->get('checklistFieldType')); ?>
        </div>
    </div>
</div>
<div class="row">
    <div class="col">
        <div class="form-group">
            <?php echo $this->formLabel($form->get('required')); ?>
            <?php echo $this->formCheckbox($form->get('required')); ?>
            <?php echo $this->formElementErrors($form->get('checklistFieldType')); ?>
        </div>
    </div>
</div>
<div class="row">
    <div class="col">
        <div class="form-group">
            <?php echo $this->formLabel($form->get('checklistFieldType')); ?>
            <?php echo $this->formSelect($form->get('checklistFieldType')); ?>
            <?php echo $this->formElementErrors($form->get('checklistFieldType')); ?>
        </div>
    </div>
</div>
<?php
echo $this->partial('partial/answers.phtml', ['answers' => $answers]);
?>


<div class="row">
    <div class="col">
        <button type="submit" id="submit" class="btn btn-dark">Opslaan</button>
    </div>
    <div class="col text-right">
        <a href="<?php echo $this->url('beheer/checklist') ?>" class="btn btn-dark" title="Annuleren">Annuleren</a>
    </div>
</div>

<?php echo $this->form()->closeTag($form); ?>


<?php
echo $this->partial('partial/answers-library.phtml', ['answers' => $answers, 'formAnswer' => $formAnswer, 'searchLinks' => $searchLinks]);
?>


<script>
    $(document).ready(function () {
        $('div#answers').hide();
        var selectedValue = $("select[name=checklistFieldType]").val();
        showAnswers(selectedValue);

        console.log(selectedValue);
        $("select[name=checklistFieldType]").change(function () {
            var selectedValue = $(this).val();
            showAnswers(selectedValue);

        });

        function showAnswers(selectedValue) {
            if (selectedValue == 3) {
                $('#answers').show();
            } else {
                $('#answers').hide();
            }
        }

        $(function () {
            $("tbody#sortable").sortable({
                stop: function (event, ui) {
                    var fieldId;
                    var fields = [];
                    $("tbody#sortable tr").each(function (index) {
                        ;
                        $(this).children('td.index').text(index + 1);
                        fieldId = $(this).data('fieldid');
                        fields.push(fieldId);
                    });
                    $.ajax({
                        type: 'POST',
                        data: {
                            fields: fields,
                        },
                        url: "<?php echo $this->url('checklistajax', ['action' => 'orderCheckListFields']); ?>",
                        async: true,
                        success: function (data) {
                            if (data.success === true) {
                            } else {
                                alert('fout');
                            }

                        }
                    });
                }
            });
        });
    });
</script>